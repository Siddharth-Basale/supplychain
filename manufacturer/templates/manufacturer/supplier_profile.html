{% load static %}  <!-- THIS IS THE CRITICAL MISSING LINE -->
<!DOCTYPE html>
<html>
<head>
    <title>{{ supplier.company_name }} Profile</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .profile-container { max-width: 800px; margin: 0 auto; }
        .profile-header { margin-bottom: 30px; }
        .profile-info { margin-bottom: 20px; }
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 4px;
        }
        /* Add basic star rating styling */
        .rating-stars { font-size: 24px; }
        .star { 
            cursor: pointer;
            color: #ddd;
        }
        .star.active { color: gold; }
    </style>
    <link rel="stylesheet" href="{% static 'manufacturer/css/rating.css' %}">
</head>
<body>
    <div class="profile-container">
        <div class="profile-header">
            <h1>{{ supplier.company_name }}</h1>
            <p>{{ supplier.first_name }} {{ supplier.last_name }}</p>
            <a href="{% url 'view_quote_bids' quote_id %}" class="back-btn">Back to Bids</a>
        </div>
        
        <div class="profile-info">
            <h2>Company Information</h2>
            <p><strong>Location:</strong> {{ supplier.city }}, {{ supplier.state }}</p>
            <p><strong>Business Type:</strong> {{ supplier.business_type }}</p>
            <p><strong>Phone:</strong> {{ supplier.phone_number }}</p>
            {% if supplier.website %}
                <p><strong>Website:</strong> <a href="{{ supplier.website }}" target="_blank">{{ supplier.website }}</a></p>
            {% endif %}
        </div>
        
        <div class="profile-info">
            <h2>Key Services</h2>
            <p>{{ supplier.key_services }}</p>
        </div>

        <div class="profile-info">
            <h2>Rate This Supplier</h2>
            <div class="rating-stars" data-supplier-id="{{ supplier.id }}" data-current-rating="{{ current_rating }}">
                <span class="star" data-value="5">★</span>
                <span class="star" data-value="4">★</span>
                <span class="star" data-value="3">★</span>
                <span class="star" data-value="2">★</span>
                <span class="star" data-value="1">★</span>
            </div>
            <p>Average Rating: {{ average_rating|default:"Not rated yet" }}</p>
        </div>
    </div>

    <script src="{% static 'manufacturer/js/rating.js' %}"></script>
    <script>
    // Basic rating functionality (can be moved to rating.js)
    document.addEventListener('DOMContentLoaded', function() {
        const stars = document.querySelectorAll('.star');
        const ratingContainer = document.querySelector('.rating-stars');
        const currentRating = ratingContainer.dataset.currentRating;
        const supplierId = ratingContainer.dataset.supplierId;
        
        // Highlight current rating
        if (currentRating) {
            stars.forEach(star => {
                if (star.dataset.value <= currentRating) {
                    star.classList.add('active');
                }
            });
        }
        
        // Handle click events
        stars.forEach(star => {
            star.addEventListener('click', function() {
                const rating = this.dataset.value;
                
                // Send rating to server
                fetch(`/manufacturer/rate-supplier/${supplierId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({rating: rating})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Update UI
                        stars.forEach(s => {
                            s.classList.remove('active');
                            if (s.dataset.value <= rating) {
                                s.classList.add('active');
                            }
                        });
                        // You might want to reload or update the average rating display
                    }
                });
            });
        });
    });
    </script>
</body>
</html>